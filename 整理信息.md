# 水运
## 输入：起始，终到，时间
## 输出：可盈利的对客户最低报价

报价金额reservation_amount列


```mermaid
graph LR
   起始发运地-->起运港;
   起运港.->过驳交货点;
   起运港 --> 目的港;
   过驳交货点.->目的港;
   目的港-->终到站;
   ```

整理出来数据，实现基于原本的数据查询的功能，输入起始发运地，终到站，时间，输出方案以及可盈利的对客户最低报价。  
其中：  
起始发运地到起运港可以采用汽运，在起运港和目的港会有港杂费用，之间通过水运运输，对于过驳交货点，可以有也可以没有分两中情况考虑，经过过驳交货点也需要有费用，从目的港到终到站也用汽运，考虑目的港即为交付地点的情况，即没有终到站。
实现筛选查询功能，选择起始发运地，终到站，时间，然后给出方案以及可盈利的对客户最低报价。  考虑情况水运签单举个例子，如当月15号签到下个月15号，但是计算本月的时候出现分段，那么采用最高的金额，比如1-15号10元，16-30号20元，那么采用都计入20元，并且告知用户我们用了这种方式处理。所以要考虑expiry_start_date和expiry_end_date

对于运输方式要看trans_mode_code  
铁运为22，汽运为21，水运为23

对于汽运只有汽运费，expens_catego_code为1001  
对于水运expens_catego_name有船运费（驳船），船运费（海船），港口包干费预定（含港杂、苫盖、理货），港杂费，目的港港杂费
代码为船运费（驳船）（3053），船运费（海船）（3054），港口包干费预定（含港杂、苫盖、理货）（3037），港杂费（3111），目的港港杂费（3034）


现在给出用数据库建表的对应关系

# cost_trans_every_cost_performance
```sql
CREATE TABLE `cost_trans_every_cost_performance` (
  `id` varchar(36) NOT NULL COMMENT '主键ID',
  `order_num` varchar(32) DEFAULT NULL COMMENT '合同子项号',
  `logi_org_id` varchar(32) DEFAULT NULL COMMENT '物流组织',
  `logi_org_name` varchar(64) DEFAULT NULL COMMENT '物流组织名称',
  `expens_catego_code` varchar(10) DEFAULT NULL COMMENT '费用类别代码',
  `expens_catego_name` varchar(64) DEFAULT NULL COMMENT '费用类别名称',
  `trans_mode_code` varchar(32) DEFAULT NULL COMMENT '运输方式代码',
  `trans_mode_name` varchar(64) DEFAULT NULL COMMENT '运输方式名称',
  `container_flag` varchar(32) DEFAULT NULL COMMENT '集装箱标志',
  `container_info` varchar(32) DEFAULT NULL COMMENT '集装箱标志含义',
  `domestic_and_foreign_trade` varchar(32) DEFAULT NULL COMMENT '内外贸代码',
  `domestic_and_foreign_trade_info` varchar(60) DEFAULT NULL COMMENT '内外贸名称',
  `product_type` varchar(32) DEFAULT NULL COMMENT '品种代码',
  `product_name` varchar(60) DEFAULT NULL COMMENT '品种名称',
  `port_of_loading_code` varchar(32) DEFAULT NULL COMMENT '起始点代码',
  `port_of_loading_name` varchar(200) DEFAULT NULL COMMENT '起始点名称',
  `transfer_type` varchar(32) DEFAULT NULL COMMENT '过驳方式',
  `transfer_name` varchar(200) DEFAULT NULL COMMENT '过驳名称',
  `port_of_destination_code` varchar(32) DEFAULT NULL COMMENT '目的地代码',
  `port_of_destination_name` varchar(200) DEFAULT NULL COMMENT '目的地名称',
  `port_of_destination_adds` varchar(200) DEFAULT NULL COMMENT '目的地地址',
  `settlement_area_code` varchar(32) DEFAULT NULL COMMENT '结算区域代码',
  `settlement_area_name` varchar(100) DEFAULT NULL COMMENT '结算区域名称',
  `tax_included_price` decimal(16,2) DEFAULT '0.00' COMMENT '含税价',
  `exc_tax_included_price` decimal(16,2) DEFAULT '0.00' COMMENT '不含税单价',
  `tram_tax_included_price` decimal(16,2) DEFAULT '0.00' COMMENT '电车含税单价',
  `tram_exc_tax_included_price` decimal(16,2) DEFAULT '0.00' COMMENT '电车不含税单价',
  `transport_miles` varchar(32) DEFAULT NULL COMMENT '海里数/公里数',
  `data_status_code` varchar(2) DEFAULT NULL COMMENT '状态代码',
  `data_status_info` varchar(10) DEFAULT NULL COMMENT '状态',
  `expiry_start_date` varchar(10) DEFAULT NULL COMMENT '有效开始日期(yyyymmdd)',
  `expiry_end_date` varchar(10) DEFAULT NULL COMMENT '有效结束日期(yyyymmdd)',
  `consolidation_method_code` varchar(10) DEFAULT NULL COMMENT '集港方式代码',
  `consolidation_method_name` varchar(64) DEFAULT NULL COMMENT '集港方式',
  `warehouse_code` varchar(32) DEFAULT NULL COMMENT '仓库代码',
  `warehouse_name` varchar(60) DEFAULT NULL COMMENT '仓库名称',
  `rec_creator` varchar(32) DEFAULT NULL COMMENT '记录创建人',
  `rec_creator_name` varchar(32) DEFAULT NULL COMMENT '记录创建人姓名',
  `rec_create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',
  `rec_revisor` varchar(32) DEFAULT NULL COMMENT '记录修改人',
  `rec_revisor_name` varchar(32) DEFAULT NULL COMMENT '记录修改人姓名',
  `rec_revise_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录修改时间',
  `archive_flag` varchar(1) DEFAULT NULL COMMENT '归档标志',
  `archive_time` datetime DEFAULT NULL COMMENT '归档时间',
  `archive_stamp_no` varchar(10) DEFAULT NULL COMMENT '归档邮戳号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='费用---各种费用实绩表';
```
```
id	varchar	36	主键ID
order_num	varchar	32	合同子项号
logi_org_id	varchar	32	物流组织
logi_org_name	varchar	64	物流组织名称
expens_catego_code	varchar	10	费用类别代码
expens_catego_name	varchar	64	费用类别名称
trans_mode_code	varchar	32	运输方式代码
trans_mode_name	varchar	64	运输方式名称
container_flag	varchar	32	集装箱标志
container_info	varchar	32	集装箱标志含义
domestic_and_foreign_trade	varchar	32	内外贸代码
domestic_and_foreign_trade_info	varchar	60	内外贸名称
product_type	varchar	32	品种代码
product_name	varchar	60	品种名称
port_of_loading_code	varchar	32	起始点代码
port_of_loading_name	varchar	200	起始点名称
transfer_type	varchar	32	过驳方式
transfer_name	varchar	200	过驳名称
port_of_destination_code	varchar	32	目的地代码
port_of_destination_name	varchar	200	目的地名称
port_of_destination_adds	varchar	200	目的地地址
settlement_area_code	varchar	32	结算区域代码
settlement_area_name	varchar	100	结算区域名称
tax_included_price	decimal	16	含税价
exc_tax_included_price	decimal	16	不含税单价
tram_tax_included_price	decimal	16	电车含税单价
tram_exc_tax_included_price	decimal	16	电车不含税单价
transport_miles	varchar	32	海里数/公里数
data_status_code	varchar	2	状态代码
data_status_info	varchar	10	状态
expiry_start_date	varchar	10	有效开始日期(yyyymmdd)
expiry_end_date	varchar	10	有效结束日期(yyyymmdd)
consolidation_method_code	varchar	10	集港方式代码
consolidation_method_name	varchar	64	集港方式
warehouse_code	varchar	32	仓库代码
warehouse_name	varchar	60	仓库名称
rec_creator	varchar	32	记录创建人
rec_creator_name	varchar	32	记录创建人姓名
rec_create_time	datetime	0	记录创建时间
rec_revisor	varchar	32	记录修改人
rec_revisor_name	varchar	32	记录修改人姓名
rec_revise_time	datetime	0	记录修改时间
archive_flag	varchar	1	归档标志
archive_time	datetime	0	归档时间
archive_stamp_no	varchar	10	归档邮戳号
```

# cost_trans_monthly_summary
```sql
CREATE TABLE `cost_trans_monthly_summary` (
  `id` varchar(36) NOT NULL COMMENT '主键ID',
  `logistics_plan_num` varchar(32) DEFAULT NULL COMMENT '物流方案号',
  `product_name` varchar(32) DEFAULT NULL COMMENT '品名细分类中文',
  `product_type` varchar(32) DEFAULT NULL COMMENT '品名细分类代码',
  `start_sending_adds_name` varchar(200) DEFAULT NULL COMMENT '起始发运地点名称',
  `start_sending_adds_code` varchar(32) DEFAULT NULL COMMENT '起始发运地点代码',
  `port_of_loading_name` varchar(200) DEFAULT NULL COMMENT '起运港名称',
  `port_of_loading_code` varchar(32) DEFAULT NULL COMMENT '起运港代码',
  `transfer_adds_name` varchar(200) DEFAULT NULL COMMENT '过驳交货地点名称',
  `transfer_adds_code` varchar(32) DEFAULT NULL COMMENT '过驳交货地点代码',
  `port_of_destination_name` varchar(200) DEFAULT NULL COMMENT '目的港名称',
  `port_of_destination_code` varchar(32) DEFAULT NULL COMMENT '目的港代码',
  `terminal_station_name` varchar(200) DEFAULT NULL COMMENT '终到站名称',
  `terminal_station_code` varchar(32) DEFAULT NULL COMMENT '终到站代码',
  `terminal_station_adds_name` varchar(255) DEFAULT NULL COMMENT '终到站详细地址',
  `dedicated_line_name` varchar(200) DEFAULT NULL COMMENT '终到站专用线名称',
  `dedicated_line_code` varchar(32) DEFAULT NULL COMMENT '终到站专用线编码',
  `reservation_amount_exc_tax` decimal(16,2) DEFAULT '0.00' COMMENT '报价不含税金额（预定不含税金额）',
  `reservation_amount` decimal(16,2) DEFAULT '0.00' COMMENT '报价金额（预定金额）',
  `settlement_amount_exc_tax` decimal(16,2) DEFAULT '0.00' COMMENT '结算不含税金额',
  `settlement_amount` decimal(16,2) DEFAULT '0.00' COMMENT '结算金额',
  `trans_mode_name` varchar(10) DEFAULT NULL COMMENT '总运输方式名称(21汽运 22 铁运 23 水运)',
  `trans_mode_code` varchar(10) DEFAULT NULL COMMENT '总运输方式代码',
  `quotation_date` varchar(10) DEFAULT NULL COMMENT '报价日期(yyyymm)',
  `expiry_start_date` varchar(12) DEFAULT NULL COMMENT '有效开始日期(yyyymmdd)',
  `expiry_end_date` varchar(12) DEFAULT NULL COMMENT '有效结束日期(yyyymmdd)',
  `rec_creator` varchar(32) DEFAULT NULL COMMENT '记录创建人',
  `rec_creator_name` varchar(32) DEFAULT NULL COMMENT '记录创建人姓名',
  `rec_create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '记录创建时间',
  `rec_revisor` varchar(32) DEFAULT NULL COMMENT '记录修改人',
  `rec_revisor_name` varchar(32) DEFAULT NULL COMMENT '记录修改人姓名',
  `rec_revise_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '记录修改时间',
  `archive_flag` varchar(1) DEFAULT NULL COMMENT '归档标志',
  `archive_time` datetime DEFAULT NULL COMMENT '归档时间',
  `archive_stamp_no` varchar(10) DEFAULT NULL COMMENT '归档邮戳号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='费用---运输费用月分汇总表';
```
```
  id	varchar	36	主键ID
  logistics_plan_num	varchar	32	物流方案号
  product_name	varchar	32	品名细分类中文
  product_type	varchar	32	品名细分类代码
  start_sending_adds_name	varchar	200	起始发运地点名称
  start_sending_adds_code	varchar	32	起始发运地点代码
  port_of_loading_name	varchar	200	起运港名称
  port_of_loading_code	varchar	32	起运港代码
  transfer_adds_name	varchar	200	过驳交货地点名称
  transfer_adds_code	varchar	32	过驳交货地点代码
  port_of_destination_name	varchar	200	目的港名称
  port_of_destination_code	varchar	32	目的港代码
  terminal_station_name	varchar	200	终到站名称
  terminal_station_code	varchar	32	终到站代码
  terminal_station_adds_name	varchar	255	终到站详细地址
  dedicated_line_name	varchar	200	终到站专用线名称
  dedicated_line_code	varchar	32	终到站专用线编码
  reservation_amount_exc_tax	decimal	16	报价不含税金额（预定不含税金额）
  reservation_amount	decimal	16	报价金额（预定金额）
  settlement_amount_exc_tax	decimal	16	结算不含税金额
  settlement_amount	decimal	16	结算金额
  trans_mode_name	varchar	10	总运输方式名称(21汽运 22 铁运 23 水运)
  trans_mode_code	varchar	10	总运输方式代码
  quotation_date	varchar	10	报价日期(yyyymm)
  expiry_start_date	varchar	12	有效开始日期(yyyymmdd)
  expiry_end_date	varchar	12	有效结束日期(yyyymmdd)
  rec_creator	varchar	32	记录创建人
  rec_creator_name	varchar	32	记录创建人姓名
  rec_create_time	datetime	0	记录创建时间
  rec_revisor	varchar	32	记录修改人
  rec_revisor_name	varchar	32	记录修改人姓名
  rec_revise_time	datetime	0	记录修改时间
  archive_flag	varchar	1	归档标志
  archive_time	datetime	0	归档时间
  archive_stamp_no	varchar	10	归档邮戳号
```





# IDEA1：
在monthly summary表中
模拟excel表中的操作筛选起始点和终止点从而确定大量路径。  
根据这些路径找每段地点在cost_performance表对应的费用  

   起始发运地-->起运港-->过驳交货点-->目的港-->终到站
   
起始发运地-->起运港这一段找汽运  
在起运港找对应的港口包干费，港杂费，船运费（海船）transfer_type = 1  
根据是否驳船找对应的船运费（驳船）transfer_type = 2  
到了目的港之后，找对应的港杂费（目的港可能为终点）
目的港-->终到站（汽运）



物化视图/缓存join，filter  

数据库分区  

bufferpool  

并行查询  

Elasticsearch   